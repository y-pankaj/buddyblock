<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BuddyBlock Options</title>
  <style>
    /* CSS Variables - Swiss Design System */
    :root {
      --color-black: #000000;
      --color-white: #FFFFFF;
      --color-red: #e30613;
      --color-gray: #e0e0e0;
      --color-gray-light: #f8f8f8;
      --color-gray-dark: #999999;
      --color-gray-medium: #95a5a6;
      
      --font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
      
      --spacing-xs: 8px;
      --spacing-sm: 16px;
      --spacing-md: 24px;
      --spacing-lg: 32px;
      --spacing-xl: 40px;
      --spacing-xxl: 48px;
      
      --transition-speed: 0.2s;
    }
    
    /* Reset & Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: var(--font-family);
      font-size: 16px;
      font-weight: 400;
      line-height: 1.5;
      color: var(--color-black);
      background-color: var(--color-white);
      background-image: 
        repeating-linear-gradient(0deg, rgba(0, 0, 0, 0.02) 0px, transparent 1px, transparent 20px, rgba(0, 0, 0, 0.02) 21px),
        repeating-linear-gradient(90deg, rgba(0, 0, 0, 0.02) 0px, transparent 1px, transparent 20px, rgba(0, 0, 0, 0.02) 21px);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: var(--spacing-lg);
    }
    
    body > * {
      width: 600px;
      max-width: 100%;
    }
    
    /* Page Title */
    h1 {
      font-size: 32px;
      font-weight: 700;
      border-bottom: 2px solid var(--color-red);
      padding-bottom: var(--spacing-sm);
      margin-bottom: var(--spacing-lg);
    }
    
    /* Section */
    .section {
      margin-bottom: var(--spacing-lg);
    }
    
    /* Primary Section - Blocked Sites */
    .section.primary {
      background-color: var(--color-white);
      border: 3px solid var(--color-black);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-xxl);
    }
    
    .section.primary h3 {
      font-size: 24px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      margin-bottom: var(--spacing-md);
      padding-bottom: var(--spacing-sm);
      border-bottom: 3px solid var(--color-red);
      color: var(--color-black);
    }
    
    .section.primary p {
      margin-bottom: var(--spacing-md);
      font-size: 18px;
      font-weight: 500;
    }
    
    /* Secondary Sections */
    .section.secondary {
      background-color: var(--color-gray-light);
      border: 1px solid var(--color-gray);
      padding: var(--spacing-md);
      margin-bottom: var(--spacing-md);
    }
    
    .section.secondary h3 {
      font-size: 12px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: var(--spacing-sm);
      padding-bottom: var(--spacing-xs);
      border-bottom: 1px solid var(--color-gray-dark);
      color: var(--color-gray-dark);
    }
    
    .section.secondary p {
      margin-bottom: var(--spacing-sm);
      font-size: 14px;
      color: var(--color-gray-dark);
    }
    
    .section.secondary h4 {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: var(--spacing-sm);
      color: var(--color-black);
    }
    
    .section h3 {
      font-size: 14px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: var(--spacing-sm);
      padding-bottom: var(--spacing-xs);
      border-bottom: 2px solid var(--color-gray);
    }
    
    .section p {
      margin-bottom: var(--spacing-sm);
      font-size: 16px;
    }
    
    .section h4 {
      font-size: 16px;
      font-weight: 500;
      margin-bottom: var(--spacing-sm);
    }
    
    /* Input and Button Combo */
    .input-group {
      display: flex;
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-md);
    }
    
    /* Primary input styling for blocked sites */
    .section.primary .input-group {
      gap: var(--spacing-md);
    }
    
    .section.primary input[type="text"] {
      flex: 1;
      border: none;
      border-bottom: 3px solid var(--color-black);
      background: transparent;
      padding: var(--spacing-md) 0;
      font-family: var(--font-family);
      font-size: 20px;
      font-weight: 500;
      transition: border-color var(--transition-speed) ease;
    }
    
    .section.primary input[type="text"]:focus {
      outline: none;
      border-bottom-color: var(--color-red);
    }
    
    input[type="text"] {
      flex: 1;
      border: none;
      border-bottom: 2px solid var(--color-black);
      background: transparent;
      padding: var(--spacing-sm) 0;
      font-family: var(--font-family);
      font-size: 16px;
      transition: border-color var(--transition-speed) ease;
    }
    
    .section.secondary input[type="text"] {
      border-bottom: 1px solid var(--color-gray-dark);
      font-size: 14px;
    }
    
    .section.secondary input[type="text"]:focus {
      border-bottom-color: var(--color-black);
    }
    
    input[type="text"]:focus {
      outline: none;
      border-bottom-color: var(--color-red);
    }
    
    input[type="text"]::placeholder {
      color: var(--color-gray-dark);
    }
    
    input[type="text"][maxlength="6"] {
      font-size: 28px;
      letter-spacing: 8px;
      text-align: center;
    }
    
    /* Buttons */
    .btn-primary {
      background-color: var(--color-red);
      color: var(--color-white);
      border: none;
      padding: var(--spacing-sm) var(--spacing-xxl);
      font-family: var(--font-family);
      font-size: 14px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: background-color var(--transition-speed) ease;
      white-space: nowrap;
    }
    
    .btn-primary:hover {
      background-color: var(--color-black);
    }
    
    /* Primary section button styling */
    .section.primary .btn-primary {
      padding: var(--spacing-md) var(--spacing-xxl);
      font-size: 16px;
      font-weight: 700;
      letter-spacing: 2px;
    }
    
    /* Secondary section button styling */
    .section.secondary .btn-primary {
      background-color: var(--color-gray-medium);
      padding: 10px 20px;
      font-size: 12px;
    }
    
    .section.secondary .btn-primary:hover {
      background-color: #7f8c8d;
    }
    
    .btn-secondary {
      background-color: var(--color-gray-medium);
      color: var(--color-white);
      border: none;
      padding: 10px 20px;
      font-family: var(--font-family);
      font-size: 14px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: background-color var(--transition-speed) ease;
      white-space: nowrap;
    }
    
    .btn-secondary:hover {
      background-color: #7f8c8d;
    }
    
    .btn-danger {
      background-color: var(--color-black);
      color: var(--color-white);
      border: none;
      padding: var(--spacing-sm) var(--spacing-xxl);
      font-family: var(--font-family);
      font-size: 14px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: background-color var(--transition-speed) ease;
    }
    
    .btn-danger:hover {
      background-color: var(--color-red);
    }
    
    .btn-danger:disabled {
      background-color: var(--color-gray-medium);
      cursor: not-allowed;
    }
    
    /* Site List */
    #blockedSitesList {
      margin-top: var(--spacing-md);
    }
    
    .site-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--spacing-md);
      border: 2px solid var(--color-black);
      background-color: var(--color-white);
      margin-bottom: var(--spacing-xs);
      transition: all var(--transition-speed) ease;
    }
    
    .site-item:hover {
      background-color: var(--color-gray-light);
      border-color: var(--color-red);
    }
    
    .site-item span {
      font-weight: 700;
      font-size: 18px;
      color: var(--color-black);
    }
    
    /* Status Messages */
    .status-message {
      padding: var(--spacing-sm);
      margin-bottom: var(--spacing-md);
      font-size: 14px;
      font-weight: 500;
    }
    
    .status-message.success {
      background-color: var(--color-white);
      border: 2px solid var(--color-black);
      color: var(--color-black);
    }
    
    .status-message.error {
      background-color: var(--color-black);
      color: var(--color-white);
      text-transform: uppercase;
    }
    
    .status-message.info {
      background-color: var(--color-gray-light);
      border-left: 3px solid var(--color-red);
      color: var(--color-black);
    }
    
    .status-message a {
      color: inherit;
      text-decoration: underline;
      font-weight: 700;
    }
    
    .hidden {
      display: none !important;
    }
    
    /* Info Box */
    .info-box {
      background-color: var(--color-gray-light);
      border-left: 3px solid var(--color-red);
      padding: var(--spacing-sm);
      margin: var(--spacing-sm) 0;
    }
    
    .info-box p {
      font-size: 14px;
      margin: 0;
    }
    
    /* QR Container */
    .qr-container {
      text-align: center;
      margin: var(--spacing-md) 0;
      padding: var(--spacing-sm);
      border: 1px solid var(--color-gray-dark);
      background-color: var(--color-white);
    }
    
    .qr-container h3 {
      font-size: 14px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: var(--spacing-sm);
      border: none;
      color: var(--color-black);
    }
    
    .qr-actions {
      margin-top: var(--spacing-sm);
    }
    
    .qr-info {
      margin-top: var(--spacing-sm);
      font-size: 11px;
      color: var(--color-gray-dark);
    }
    
    /* Danger Zone */
    .danger-zone {
      margin-top: var(--spacing-md);
      padding: var(--spacing-md);
      border: 1px solid var(--color-gray);
      background-color: var(--color-gray-light);
    }
    
    .danger-zone h3 {
      color: var(--color-gray-dark);
      font-size: 12px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: var(--spacing-sm);
      padding-bottom: var(--spacing-xs);
      border-bottom: 1px solid var(--color-gray-dark);
    }
    
    .reset-section {
      margin-top: var(--spacing-sm);
    }
    
    .reset-section p {
      margin: var(--spacing-xs) 0;
      font-size: 12px;
      color: var(--color-gray-dark);
    }
    
    .reset-section h4 {
      font-size: 14px;
      color: var(--color-black);
    }
    
    .reset-section input[type="text"] {
      border-bottom: 1px solid var(--color-gray-dark);
      font-size: 20px;
    }
    
    .reset-section .btn-danger {
      background-color: var(--color-gray-medium);
      padding: 10px 20px;
      font-size: 12px;
    }
    
    .reset-section .btn-danger:hover {
      background-color: var(--color-red);
    }
    
    .error-message {
      color: var(--color-red);
      margin-top: var(--spacing-sm);
      font-size: 12px;
      font-weight: 500;
      text-transform: uppercase;
    }
    
    /* Modal */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    
    .modal.hidden {
      display: none;
    }
    
    .modal-content {
      background: var(--color-white);
      max-width: 400px;
      width: 90%;
      border: 2px solid var(--color-black);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--spacing-md);
      border-bottom: 2px solid var(--color-gray);
    }
    
    .modal-header h2 {
      margin: 0;
      color: var(--color-black);
      font-size: 18px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .close-btn {
      background: none;
      border: none;
      font-size: 28px;
      cursor: pointer;
      color: var(--color-black);
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color var(--transition-speed) ease;
    }
    
    .close-btn:hover {
      color: var(--color-red);
    }
    
    .modal-body {
      padding: var(--spacing-md);
    }
    
    .modal-body p {
      margin: var(--spacing-sm) 0;
      font-size: 14px;
    }
    
    .modal-body p strong {
      color: var(--color-red);
      font-weight: 700;
    }
    
    .modal-body input[type="text"] {
      width: 100%;
      margin: var(--spacing-sm) 0;
      font-size: 28px;
      letter-spacing: 8px;
      text-align: center;
    }
    
    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: var(--spacing-sm);
      padding: var(--spacing-sm) var(--spacing-md);
      border-top: 2px solid var(--color-gray);
      background-color: var(--color-gray-light);
    }
    
    /* Responsive */
    @media (max-width: 600px) {
      body {
        padding: var(--spacing-sm);
      }
      
      body > * {
        width: 100%;
      }
      
      h1 {
        font-size: 28px;
      }
      
      .input-group {
        flex-direction: column;
      }
      
      .btn-primary,
      .btn-secondary,
      .btn-danger {
        width: 100%;
        padding: var(--spacing-sm) var(--spacing-md);
      }
    }
  </style>
</head>
<body>
  <h1>BuddyBlock Options</h1>
  
  <!-- Setup Warning Banner -->
  <div id="setupWarning" class="status-message error hidden">
    ⚠️ <strong>Setup Required:</strong> You must complete the initial setup before adding websites to block. 
    <a href="setup.html">Complete Setup Now</a>
  </div>
  
  <!-- Status Message -->
  <div id="statusMessage" class="status-message hidden"></div>
  
  <!-- Blocked Sites Management -->
  <div class="section primary">
    <h3>Blocked Sites</h3>
    <p>Add websites to block:</p>
    <div class="input-group">
      <input type="text" id="newSite" placeholder="Enter website domain">
      <button id="addSiteBtn" class="btn-primary">Add</button>
    </div>
    
    <div id="blockedSitesList">
      <!-- Sites will be populated here -->
    </div>
  </div>
  
  <!-- TOTP Setup Section -->
  <div class="section secondary">
    <h3>One-Time Code Authentication</h3>
    
    <div class="info-box">
      <p><strong>✓ Setup Complete</strong> — Your one-time code authentication is configured and protecting your blocked sites.</p>
    </div>
    
    <!-- TOTP verification section for showing QR on new device -->
    <div id="totpVerificationSection">
      <h4>Show Setup QR for New Device</h4>
      <p>Need to set up the authenticator on a new phone? Enter your current one-time code to display the setup QR:</p>
      <div class="input-group">
        <input type="text" id="totpInput" placeholder="000000" maxlength="6" autocomplete="off" inputmode="numeric">
        <button id="showSetupQRBtn" class="btn-primary">Show QR</button>
      </div>
      <div class="info-box">
        <p><strong>Use case:</strong> Setting up the authenticator on a new phone or sharing access with authorized users.</p>
      </div>
    </div>
    
    <!-- Hidden first time section (no longer used, setup is mandatory at install) -->
    <div id="firstTimeSection" class="hidden" style="display: none;">
      <p>Set up your authenticator app by scanning the QR code below. <strong>You can only do this once!</strong></p>
      <button id="generateTOTPBtn" class="btn-primary">Generate One-Time Code Setup QR</button>
    </div>
    
    <!-- QR Display Section (moved inside secondary section) -->
    <div id="qrContainer" class="qr-container hidden">
      <h3 id="qrTitle">QR Code</h3>
      <canvas id="qrCanvas"></canvas>
      <div class="qr-actions">
        <button id="downloadQRBtn" class="btn-secondary">Download</button>
        <button id="clearQRBtn" class="btn-secondary">Hide QR</button>
      </div>
      <div class="qr-info">
        <p><small>This QR contains your one-time code setup. Anyone who scans it can generate bypass codes.</small></p>
      </div>
    </div>
  </div>
  
  <!-- Danger Zone -->
  <div id="dangerZone" class="danger-zone">
    <h3>⚠ Danger Zone</h3>
    <div class="reset-section">
      <h4>Reset All Settings</h4>
      <p>This will permanently delete all blocked sites and one-time code configuration.</p>
      
      <!-- Show different UI based on TOTP setup status -->
      <div id="resetWithTOTP" class="hidden">
        <p><strong>Enter your one-time code to confirm reset:</strong></p>
        <input type="text" id="resetTotpInput" placeholder="000000" maxlength="6" autocomplete="off" inputmode="numeric">
        <button id="resetWithTOTPBtn" class="btn-danger">Reset All Settings</button>
        <div id="resetError" class="error-message"></div>
      </div>
      
      <div id="resetWithoutTOTP" class="hidden">
        <p><em>One-time code not set up yet. Reset is available without verification.</em></p>
        <button id="resetWithoutTOTPBtn" class="btn-danger">Reset All Settings</button>
      </div>
    </div>
  </div>

  <!-- TOTP Removal Modal -->
  <div id="totpRemoveModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Verify One-Time Code</h2>
        <button id="closeModal" class="close-btn" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body">
        <p>You are about to remove: <strong id="siteToRemove"></strong></p>
        <p>Enter your one-time code to confirm removal:</p>
        <input type="text" id="totpRemoveInput" placeholder="000000" maxlength="6" autocomplete="off" inputmode="numeric">
        <div id="totpRemoveError" class="error-message"></div>
      </div>
      <div class="modal-footer">
        <button id="cancelRemove" class="btn-secondary">Cancel</button>
        <button id="confirmRemove" class="btn-danger">Remove</button>
      </div>
    </div>
  </div>

  <script src="lib/otpauth.umd.min.js"></script>
  <script src="lib/qrcode.min.js"></script>
  <script src="options.js"></script>
</body>
</html>
